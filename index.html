<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUWELL Studio 3.8 (Crop Feature)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Black+Han+Sans&family=Do+Hyeon&family=Jua&family=Nanum+Pen+Script&family=Gugi&family=Yeon+Sung&family=East+Sea+Dokdo&family=Gamja+Flower&family=Sunflower:wght@300;500;700&family=Gaegu&family=Poor+Story&family=Song+Myung&family=Stylish&display=swap" rel="stylesheet">
    <style>
        :root { --duwell-wine: #800020; --sidebar-width: 380px; --towel-texture: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8Y2lyY2xlIGN4PSIyIiBjeT0iMiIgcj0iMSIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPC9zdmc+'); }
        * { box-sizing: border-box; touch-action: manipulation; }
        
        body { 
            font-family: 'Noto Sans KR', sans-serif; margin: 0; padding: 0; 
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%); 
            height: 100vh; overflow: hidden; display: flex; flex-direction: column; 
        }
        
        /* í—¤ë” */
        header { height: 60px; background: white; border-bottom: 1px solid #ddd; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 100; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .brand { color: var(--duwell-wine); font-size: 20px; font-weight: 900; display: flex; align-items: center; gap: 10px; }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .price-tag { font-weight: bold; font-size: 16px; color: #333; }
        .btn-order { background: var(--duwell-wine); color: white; padding: 8px 20px; border-radius: 6px; font-weight: bold; border: none; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(128,0,32,0.2); }
        .btn-order:hover { transform: translateY(-2px); box-shadow: 0 6px 10px rgba(128,0,32,0.3); }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container { display: flex; flex: 1; overflow: hidden; position: relative; }

        /* ì•„ì½”ë””ì–¸ ì‚¬ì´ë“œë°” */
        .sidebar { width: var(--sidebar-width); background: white; border-right: 1px solid #ddd; display: flex; flex-direction: column; z-index: 20; flex-shrink: 0; overflow-y: auto; }
        
        .accordion-item { border-bottom: 1px solid #eee; }
        .accordion-header { 
            width: 100%; padding: 18px 20px; background: white; border: none; outline: none; text-align: left; cursor: pointer; 
            font-size: 16px; font-weight: 700; color: #333; display: flex; justify-content: space-between; align-items: center; transition: 0.2s;
        }
        .accordion-header:hover { background: #f9f9f9; }
        .accordion-header.active { background: #fff5f5; color: var(--duwell-wine); border-left: 4px solid var(--duwell-wine); padding-left: 16px; }
        .accordion-header::after { content: 'âˆ¨'; font-size: 12px; font-weight: bold; color: #999; transition: 0.2s; }
        .accordion-header.active::after { transform: rotate(180deg); color: var(--duwell-wine); }
        
        .accordion-content { 
            display: none; padding: 20px; background: #fafafa; border-top: 1px solid #f0f0f0; 
            animation: slideDown 0.3s ease-out;
        }
        .accordion-content.show { display: block; }

        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* ì‘ì—… ì˜ì—­ */
        .workspace { flex: 1; position: relative; display: flex; flex-direction: column; background: #eef2f5; overflow: hidden; }
        .toolbar { height: 50px; background: white; border-bottom: 1px solid #e0e0e0; display: flex; align-items: center; padding: 0 15px; gap: 10px; justify-content: center; }
        .canvas-area { flex: 1; display: flex; align-items: center; justify-content: center; overflow: auto; padding: 40px; }
        
        /* UI ìš”ì†Œ */
        .group-label { font-size: 13px; color: #666; font-weight: bold; margin-bottom: 8px; display: block; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .item-btn { border: 1px solid #ddd; background: white; padding: 10px; border-radius: 6px; cursor: pointer; text-align: center; font-size: 13px; transition: 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 50px; }
        .item-btn:hover { background: #fff; border-color: var(--duwell-wine); color: var(--duwell-wine); }
        .item-btn.active { background: var(--duwell-wine); color: white; border-color: var(--duwell-wine); }
        .item-btn svg { width: 28px; height: 28px; margin-bottom: 5px; fill: currentColor; }
        .design-btn { height: 90px; padding: 5px; background-size: contain; background-repeat: no-repeat; background-position: center; border: 1px solid #eee; background-color: #fff; }
        .color-circle { width: 45px; height: 45px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; position: relative; margin-bottom: 5px; }
        .color-circle.active { border-color: var(--duwell-wine); transform: scale(1.15); box-shadow: 0 0 0 2px rgba(128,0,32,0.2); }
        .input-field { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; margin-bottom: 10px; }
        .select-field { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; background: white; cursor: pointer; margin-bottom: 15px; }
        .color-picker-box { width:100%; height:40px; cursor:pointer; border:1px solid #ddd; border-radius:5px; padding:2px; }

        .text-controls { display: flex; flex-direction: column; gap: 10px; background: white; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; }
        .control-row { display: flex; align-items: center; gap: 10px; justify-content: space-between; }
        .control-btn { flex: 1; padding: 8px; border: 1px solid #ddd; background: white; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .slider-container { flex: 1; display: flex; align-items: center; gap: 10px; }
        .slider-container input { flex: 1; accent-color: var(--duwell-wine); }
        .slider-val { font-size: 12px; font-weight: bold; width: 30px; text-align: right; }

        /* ìˆ˜ê±´ ëª©ì—… ë° ì¸ì‡„ì˜ì—­ ë¼ë²¨ */
        .mockup-wrapper { transform-origin: center center; transition: transform 0.2s; box-shadow: 0 20px 50px rgba(0,0,0,0.15); }
        #towelMockup { width: 900px; display: flex; flex-direction: column; align-items: center; background: white; }
        .terry-texture { background-color: var(--towel-color); background-image: var(--towel-texture); background-blend-mode: multiply; }
        .towel-top { width: 100%; height: 70px; border-radius: 12px 12px 0 0; }
        .towel-bottom { width: 100%; height: 90px; border-radius: 0 0 12px 12px; }
        .canvas-band-wrapper { width: 100%; display: flex; justify-content: center; position: relative; }
        .mode-print .canvas-band-wrapper { background: #ffffff; padding: 4px 0; }
        .mode-embroidery .embroidery-bg { display: block; position: absolute; top:0; left:0; width:100%; height:100%; }
        
        .size-label {
            position: absolute; top: -35px; left: 50%; transform: translateX(-50%);
            background: rgba(128,0,32, 0.9); color: white; padding: 6px 15px; border-radius: 20px;
            font-size: 13px; font-weight: bold; pointer-events: none; white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .size-label::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            border-width: 5px; border-style: solid; border-color: rgba(128,0,32, 0.9) transparent transparent transparent;
        }

        /* íˆ´ë°” ë²„íŠ¼ ê³µí†µ */
        .tool-btn { background: transparent; border: none; padding: 8px 12px; cursor: pointer; border-radius: 4px; display: flex; align-items: center; gap: 5px; font-size: 13px; font-weight: 500; color: #444; }
        .tool-btn:hover { background: #eee; }
        .tool-btn.danger { color: #e74c3c; }

        /* [NEW] ì´ë¯¸ì§€ ìë¥´ê¸° ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #cropModal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.85); z-index: 20000; justify-content: center; align-items: center; flex-direction: column;
        }
        .crop-container { width: 90%; max-width: 600px; height: 60%; background: #000; margin-bottom: 20px; }
        .crop-container img { display: block; max-width: 100%; }
        .crop-actions { display: flex; gap: 15px; }
        .crop-btn { padding: 12px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; border: none; font-size: 16px; }
        .crop-confirm { background: var(--duwell-wine); color: white; }
        .crop-cancel { background: #fff; color: #333; }

        /* íŒì—… ë° ë¡œë” */
        #customPopup { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 10000; justify-content: center; align-items: center; }
        .popup-content { background: white; padding: 25px; border-radius: 15px; width: 300px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .popup-btn { background: var(--duwell-wine); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--duwell-wine); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ëª¨ë°”ì¼ ëŒ€ì‘ */
        @media (max-width: 768px) and (orientation: portrait) {
            body { flex-direction: column; height: auto; overflow-y: auto; }
            .main-container { flex-direction: column-reverse; height: auto; overflow: visible; }
            .sidebar { width: 100%; height: auto; border-right: none; border-top: 2px solid var(--duwell-wine); }
            .toolbar { justify-content: space-between; padding: 0 5px; }
            .tool-btn { font-size: 11px; padding: 6px 4px; gap: 2px; }
            .workspace { height: 350px; flex: none; border-bottom: 1px solid #ddd; }
            .canvas-area { padding: 0; overflow: hidden; display: flex; align-items: center; justify-content: center; background: #eef2f5; }
            .mockup-wrapper { transform: scale(0.32); margin: 0; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        }

        @media (max-width: 920px) and (orientation: landscape) {
            body { flex-direction: column; overflow: hidden; height: 100vh; }
            .main-container { flex-direction: row; height: 100%; overflow: hidden; }
            header { display: none; } 
            .sidebar { width: 260px; height: 100%; border-right: 1px solid #ddd; border-top: none; }
            .workspace { height: 100%; flex: 1; border-bottom: none; }
            .mockup-wrapper { transform: scale(0.45); transform-origin: center center; }
            .toolbar { overflow-x: auto; justify-content: flex-start; }
            #mobileLandscapeOrderBtn { display: block !important; position: absolute; top: 10px; right: 10px; z-index: 500; }
        }
        
        #mobileLandscapeOrderBtn { display: none; }
    </style>
</head>
<body>

<div id="loading">
    <div class="loader"></div>
    <h3 style="color:var(--duwell-wine);">DUWELL STUDIO</h3>
    <p style="font-size:13px; color:#666;">ë””ìì¸ ë„êµ¬ ì´ˆê¸°í™” ì¤‘...</p>
</div>

<div id="cropModal">
    <div class="crop-container">
        <img id="imageToCrop" src="" alt="Crop Image">
    </div>
    <div class="crop-actions">
        <button class="crop-btn crop-cancel" onclick="cancelCrop()">ì·¨ì†Œ</button>
        <button class="crop-btn crop-confirm" onclick="confirmCrop()">âœ‚ï¸ ìë¥´ê¸° ì™„ë£Œ</button>
    </div>
</div>

<button id="mobileLandscapeOrderBtn" class="btn-order" onclick="openAccordion('checkout')">ì£¼ë¬¸í•˜ê¸°</button>

<div id="customPopup">
    <div class="popup-content">
        <h3 id="popupTitle" style="color:var(--duwell-wine); margin:0 0 10px 0;">ì•Œë¦¼</h3>
        <p id="popupMsg" style="font-size:14px; color:#555; line-height:1.5;">ë‚´ìš©</p>
        <button class="popup-btn" onclick="closePopup()">í™•ì¸</button>
    </div>
</div>

<header>
    <div class="brand">
        <svg viewBox="0 0 24 24" style="width:24px; height:24px; fill:#333; cursor:pointer;" onclick="alert('DUWELL Studio 3.8')"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        <span>DUWELL STUDIO</span>
    </div>
    <div class="header-actions">
        <div class="price-tag">ì´ <span id="headerPrice">0</span>ì›</div>
        <button class="btn-order" onclick="openAccordion('checkout')">ì£¼ë¬¸í•˜ê¸°</button>
    </div>
</header>

<div class="main-container">
    <div class="sidebar">
        <div class="accordion-item">
            <button class="accordion-header active" onclick="toggleAccordion('product', this)">1. ì œí’ˆ ë° ì œì‘ ë°©ì‹ ì„ íƒ</button>
            <div id="acc-product" class="accordion-content show">
                <label class="group-label">ì œí’ˆ ë¼ì¸ì—…</label>
                <select id="productSelect" class="select-field" onchange="changeProduct()"></select>
                <label class="group-label">ì œì‘ ë°©ì‹</label>
                <div class="grid-2">
                    <button id="btn-p" class="item-btn" onclick="setMode('print')"><span style="font-size:18px;">ğŸ–¨ï¸</span> ì „ì‚¬ ì¸ì‡„</button>
                    <button id="btn-e" class="item-btn" onclick="setMode('embroidery')"><span style="font-size:18px;">ğŸ§µ</span> ì»´í“¨í„° ììˆ˜</button>
                </div>
                <div id="embroideryWarning" style="font-size:11px; color:#e74c3c; display:none; background:#fff0f0; padding:10px; border-radius:4px;">â€» ììˆ˜ëŠ” ë„ì•ˆ ì¹¨ìˆ˜(ë³µì¡ë„)ì— ë”°ë¼ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('color', this)">2. ìˆ˜ê±´ ìƒ‰ìƒ ë³€ê²½</button>
            <div id="acc-color" class="accordion-content">
                <label class="group-label">ë² ì´ìŠ¤ ì»¬ëŸ¬ ì„ íƒ</label>
                <div id="towel-grid" style="display:flex; flex-wrap:wrap; gap:12px;"></div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('design', this)">3. ì¶”ì²œ ë””ìì¸ (ë¡œê³ /ìƒ˜í”Œ)</button>
            <div id="acc-design" class="accordion-content">
                <div id="design-grid" class="grid-2"></div>
                <p style="font-size:12px; color:#888;">ì›í•˜ëŠ” ë””ìì¸ì„ í´ë¦­í•˜ì—¬ ì ìš©í•˜ì„¸ìš”.</p>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('text', this)">4. í…ìŠ¤íŠ¸(ë¬¸êµ¬) ë„£ê¸°</button>
            <div id="acc-text" class="accordion-content">
                <div class="text-controls">
                    <div class="control-row">
                        <label style="font-size:12px; font-weight:bold;">í¬ê¸°</label>
                        <div class="slider-container">
                            <input type="range" id="fontSizeSlider" min="10" max="200" value="40" oninput="changeFontSize(this.value)">
                            <span id="fontSizeDisplay" class="slider-val">40</span>
                        </div>
                    </div>
                    <div class="control-row">
                        <label style="font-size:12px; font-weight:bold;">ì •ë ¬</label>
                        <button class="control-btn" onclick="setTextAlign('left')">ì¢Œì¸¡</button>
                        <button class="control-btn" onclick="setTextAlign('center')">ì¤‘ì•™</button>
                        <button class="control-btn" onclick="setTextAlign('right')">ìš°ì¸¡</button>
                    </div>
                </div>
                <label class="group-label">í°íŠ¸ ìŠ¤íƒ€ì¼</label>
                <div id="font-grid" style="display:flex; flex-direction:column; gap:8px; max-height:200px; overflow-y:auto;"></div>
                <div style="margin-top:15px;">
                    <label class="group-label">ê¸€ì ìƒ‰ìƒ</label>
                    <input type="color" id="textColorPicker" value="#333333" oninput="changeObjColor(this.value)" class="color-picker-box">
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('icon', this)">5. ì•„ì´ì½˜ ê¾¸ë¯¸ê¸°</button>
            <div id="acc-icon" class="accordion-content">
                <label class="group-label">ì•„ì´ì½˜ ì„ íƒ (20ì¢…)</label>
                <div id="icon-grid" class="grid-3" style="max-height:300px; overflow-y:auto;"></div>
                <div style="margin-top:15px; border-top:1px dashed #ddd; padding-top:15px;">
                    <label class="group-label">ğŸ¨ ì•„ì´ì½˜ ìƒ‰ìƒ ë³€ê²½</label>
                    <input type="color" id="iconColorPicker" value="#333333" oninput="changeObjColor(this.value)" class="color-picker-box">
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('upload', this)">6. ë‚´ ì´ë¯¸ì§€ ì—…ë¡œë“œ</button>
            <div id="acc-upload" class="accordion-content">
                <button class="item-btn" onclick="document.getElementById('upload').click()" style="width:100%; border:2px dashed #ddd; background:#fafafa;">ğŸ“‚ ë‚´ ê¸°ê¸°ì—ì„œ ì‚¬ì§„ ì°¾ê¸°</button>
                <input type="file" id="upload" accept="image/*" style="display:none">
                <div style="margin-top:10px; background:#fff5f5; padding:10px; border-radius:5px; font-size:12px; color:#e74c3c; line-height:1.4;">
                    <strong>âš ï¸ í™”ì§ˆ ì£¼ì˜</strong><br>
                    ì—…ë¡œë“œí•˜ì‹  ì´ë¯¸ì§€ í™”ì§ˆì´ ë‚®ìœ¼ë©´ ì¸ì‡„ ì‹œ íë¦¬ê²Œ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                    ê°€ëŠ¥í•œ <strong>í¬ê³  ì„ ëª…í•œ ì›ë³¸ ì‚¬ì§„</strong>ì„ ì˜¬ë ¤ì£¼ì„¸ìš”.
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" onclick="toggleAccordion('checkout', this)" style="color:var(--duwell-wine);">7. ìµœì¢… ì£¼ë¬¸ì„œ ì‘ì„±</button>
            <div id="acc-checkout" class="accordion-content">
                <label class="group-label">ì£¼ë¬¸ì ì •ë³´</label>
                <input type="text" id="custName" placeholder="ì„±í•¨" class="input-field">
                <input type="tel" id="custPhone" placeholder="ì—°ë½ì²˜" class="input-field">
                <input type="text" id="custAddress" placeholder="ì£¼ì†Œ" class="input-field">
                
                <label class="group-label" style="margin-top:15px;">ğŸ“… í¬ë§ ìˆ˜ë ¹ì¼</label>
                <input type="date" id="custDeliveryDate" class="input-field">
                
                <hr style="border:0; border-top:1px dashed #ddd; margin:15px 0;">
                <label class="group-label">í¬ì¥ ì˜µì…˜</label>
                <select id="packagingSelect" class="select-field" onchange="calcPrice()"></select>
                <label class="group-label">ìˆ˜ëŸ‰ (ì¥)</label>
                <input type="number" id="custQty" placeholder="0" class="input-field" style="font-weight:bold; font-size:18px; color:var(--duwell-wine);" oninput="calcPrice()">
                <div style="text-align:right; font-weight:bold; font-size:20px; color:var(--duwell-wine); margin:15px 0;">ì˜ˆìƒ ê¸ˆì•¡: <span id="displayPriceCheckout">0ì›</span></div>
                <button class="btn-order" onclick="sendDataToGoogleSheet()" style="width:100%; padding:15px; font-size:16px;">ì£¼ë¬¸ ì „ì†¡í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <main class="workspace">
        <div class="toolbar">
            <button class="tool-btn" onclick="alignObj('left')">âª ì¢Œì¸¡</button>
            <button class="tool-btn" onclick="alignObj('centerH')">â†” ì¤‘ì•™</button>
            <button class="tool-btn" onclick="alignObj('right')">â© ìš°ì¸¡</button>
            <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
            <button class="tool-btn" onclick="changeLayer('front')">ğŸ”¼ ìœ„ë¡œ</button>
            <button class="tool-btn" onclick="changeLayer('back')">ğŸ”½ ì•„ë˜ë¡œ</button>
            <div style="width:1px; height:20px; background:#ddd; margin:0 5px;"></div>
            <button class="tool-btn danger" onclick="deleteObj()">ğŸ—‘ ì‚­ì œ</button>
        </div>

        <div class="canvas-area">
            <div class="mockup-wrapper">
                <div id="towelMockup" class="mode-print">
                    <div class="towel-body towel-top terry-texture"></div>
                    <div class="band-container" style="width:100%; position:relative; z-index:1;">
                        <div class="embroidery-bg terry-texture" style="display:none;"></div>
                        <div class="size-label">ğŸ“ ì¸ì‡„ ê°€ëŠ¥ ì˜ì—­: 38cm x 4.5cm</div>
                        <div class="canvas-band-wrapper"><canvas id="mainCanvas"></canvas></div>
                    </div>
                    <div class="towel-body towel-bottom terry-texture"></div>
                </div>
                <p id="modeText" style="text-align:center; margin-top:20px; color:#888; font-size:14px;">â— ì „ì‚¬ ì¸ì‡„ ëª¨ë“œ</p>
            </div>
        </div>
    </main>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyBCyLgcfEqTXTWmDeGcuw2ib2yDmSYEONpHGlLmZWZjKV17nUgD8CVjn12sQv-VnVF/exec'; 

    const canvas = new fabric.Canvas('mainCanvas', { width: 866, height: 100, backgroundColor: '#ffffff', preserveObjectStacking: true });
    
    fabric.Object.prototype.set({
        transparentCorners: false, cornerColor: '#ffffff', cornerStrokeColor: '#800020',
        borderColor: '#800020', cornerSize: 12, padding: 10, cornerStyle: 'circle', borderDashArray: [4, 4]
    });

    let currentMode = 'print', currentTowelColor = '#ffffff', guide;
    let currentPrice = 0, selectedProductName = "", packagingCost = 0;
    let productData = [], packagingData = [];
    
    // Cropper ë³€ìˆ˜
    let cropper;
    const cropModal = document.getElementById('cropModal');
    const imageToCrop = document.getElementById('imageToCrop');

    const iconPaths = {
        'í•˜íŠ¸': 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        'ë³„': 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z',
        'ì™•ê´€': 'M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-1h14v1z',
        'ìŠ¤ë§ˆì¼': 'M12 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z',
        'ì²´í¬': 'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z',
        'ìë™ì°¨': 'M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99z',
        'íŠ¸ë¡œí”¼': 'M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 10.63 21 8.55 21 8V7c0-1.1-.9-2-2-2zM5 8V7h2v3.82C5.84 10.4 5 9.3 5 8zm14 2.82c-.84.42-1.68.58-2 .63V7h2v1z',
        'ë¹„í–‰ê¸°': 'M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z',
        'ì¹´ë©”ë¼': 'M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9z',
        'í•´': 'M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z',
        'ë‹¬': 'M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z',
        'êµ¬ë¦„': 'M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z',
        'ì§‘': 'M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z',
        'ì‚¼ê°í˜•': 'M12 2L2 22h20L12 2z',
        'ì›': 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z',
        'ì‚¬ê°í˜•': 'M3 3h18v18H3z',
        'ì‹­ìê°€': 'M11 2v6H5v4h6v10h4V12h6V8h-6V2z',
        'ìŒí‘œ': 'M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z',
        'ë‹¤ì´ì•„': 'M19 3H5L2 9l10 12L22 9l-3-6z',
        'ì„ ë¬¼': 'M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2z'
    };

    function toggleAccordion(id, btnElement) {
        const content = document.getElementById('acc-' + id);
        const isOpen = content.classList.contains('show');
        document.querySelectorAll('.accordion-content').forEach(el => el.classList.remove('show'));
        document.querySelectorAll('.accordion-header').forEach(el => el.classList.remove('active'));
        if (!isOpen) {
            content.classList.add('show');
            if(btnElement) btnElement.classList.add('active');
        }
    }

    function openAccordion(id) {
        const content = document.getElementById('acc-' + id);
        const header = content.previousElementSibling;
        document.querySelectorAll('.accordion-content').forEach(el => el.classList.remove('show'));
        document.querySelectorAll('.accordion-header').forEach(el => el.classList.remove('active'));
        content.classList.add('show');
        header.classList.add('active');
        header.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    const recommendedDesigns = [
        { name: 'ê°ì‚¬', url: 'https://via.placeholder.com/200/800020/FFFFFF?text=Thank+You' },
        { name: 'ìƒì¼', url: 'https://via.placeholder.com/200/e67e22/FFFFFF?text=Happy+B-Day' },
        { name: 'ì›¨ë”©', url: 'https://via.placeholder.com/200/e91e63/FFFFFF?text=Wedding' },
        { name: 'ì²«ëŒ', url: 'https://via.placeholder.com/200/3498db/FFFFFF?text=1st+B-Day' },
        { name: 'ë¡œê³ ', url: 'https://via.placeholder.com/200/2ecc71/FFFFFF?text=Logo' },
        { name: 'ê¸°íƒ€', url: 'https://via.placeholder.com/200/333333/FFFFFF?text=Etc' }
    ];

    function showPopup(title, msg) {
        document.getElementById('popupTitle').innerText = title;
        document.getElementById('popupMsg').innerHTML = msg;
        document.getElementById('customPopup').style.display = 'flex';
    }
    function closePopup() { document.getElementById('customPopup').style.display = 'none'; }

    async function fetchData() {
        try {
            const response = await fetch(scriptURL);
            const data = await response.json();
            productData = data.products;
            packagingData = data.packaging;
            init();
            document.getElementById('loading').style.display = 'none';
        } catch (error) {
            showPopup("ì˜¤ë¥˜", "ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.");
        }
    }

    function init() {
        guide = new fabric.Rect({ left: 5, top: 5, width: 856, height: 90, fill: 'transparent', stroke: '#800020', strokeDashArray: [4, 4], selectable: false, evented: false, opacity: 0.3 });
        canvas.add(guide);
        
        const ig = document.getElementById('icon-grid');
        Object.keys(iconPaths).forEach(n => {
            let b = document.createElement('button'); b.className='item-btn'; b.onclick=()=>addIcon(n);
            b.innerHTML = `<svg viewBox="0 0 24 24"><path d="${iconPaths[n]}"></path></svg><span>${n}</span>`;
            ig.appendChild(b);
        });

        const fg = document.getElementById('font-grid');
        ['Noto Sans KR', 'Nanum Myeongjo', 'Do Hyeon', 'Jua', 'Nanum Pen Script', 'Black Han Sans', 'Gugi', 'Yeon Sung', 'East Sea Dokdo', 'Gamja Flower', 'Poor Story', 'Gaegu', 'Sunflower', 'Song Myung', 'Stylish'].forEach(f => {
            let b = document.createElement('button'); b.className='item-btn'; b.style.fontFamily=f; b.onclick=()=>addText(f, 'DUWELL'); 
            b.style.flexDirection = 'row'; b.style.justifyContent='space-between'; b.style.padding='15px';
            b.innerHTML = `<span style="font-size:16px;">${f}</span><span style="font-size:12px; color:#aaa;">ê°€ë‚˜ë‹¤</span>`;
            fg.appendChild(b);
        });

        const dg = document.getElementById('design-grid');
        recommendedDesigns.forEach(d => {
            let b = document.createElement('button');
            b.className = 'item-btn design-btn';
            b.style.backgroundImage = `url('${d.url}')`;
            b.onclick = () => addDesignImage(d.url);
            b.innerHTML = `<span style="background:rgba(255,255,255,0.8); padding:2px 5px; border-radius:4px; font-size:11px; margin-top:auto;">${d.name}</span>`;
            dg.appendChild(b);
        });

        const ps = document.getElementById('productSelect');
        ps.innerHTML = "";
        productData.forEach((p, index) => {
            let opt = document.createElement('option'); opt.value = index; opt.innerText = `${p.name} (${p.price.toLocaleString()}ì›)`; ps.appendChild(opt);
        });

        const packSel = document.getElementById('packagingSelect');
        packSel.innerHTML = "";
        packagingData.forEach((p, index) => {
            let opt = document.createElement('option'); opt.value = index; opt.innerText = `${p.name} (${p.price.toLocaleString()}ì›)`; packSel.appendChild(opt);
        });
        
        document.querySelectorAll('.input-field').forEach(input => {
            input.addEventListener('focus', () => { canvas.discardActiveObject(); canvas.renderAll(); });
        });

        changeProduct();
    }

// ê¸°ì¡´ ì½”ë“œ
// product.colors.forEach((c, idx) => { ...

// ğŸ‘‡ ì´ë ‡ê²Œ ìˆ˜ì •í•´ì£¼ì„¸ìš” (ì•ˆì „ ì¥ì¹˜ ì¶”ê°€)
function changeProduct() {
    if(productData.length === 0) return;
    const index = document.getElementById('productSelect').value;
    const product = productData[index];
    currentPrice = product.price || 0;
    selectedProductName = product.name;
    calcPrice();
    
    const tg = document.getElementById('towel-grid');
    tg.innerHTML = '';
    
    // [í•µì‹¬] ì‹œíŠ¸ì— ìƒ‰ìƒ ì •ë³´ê°€ ì•„ì˜ˆ ì—†ìœ¼ë©´ ê¸°ë³¸ìœ¼ë¡œ í•˜ì–€ìƒ‰(#ffffff)ì„ ë„ìš°ë„ë¡ ë°©ì–´
    const colors = product.colors && product.colors.length > 0 ? product.colors : ["#ffffff"];
    
    colors.forEach((c, idx) => {
        let d = document.createElement('div'); 
        d.className='color-circle'; 
        d.style.backgroundColor=c; 
        d.onclick=()=>setTowel(c, d); 
        tg.appendChild(d);
        if(idx === 0) setTowel(c, d); // ì²« ë²ˆì§¸ ìƒ‰ìƒ ìë™ ì„ íƒ
    });
}

    function calcPrice() {
        if(packagingData.length === 0) return;
        const qty = document.getElementById('custQty').value;
        const packIndex = document.getElementById('packagingSelect').value;
        packagingCost = packagingData[packIndex].price;
        let total = 0; if (qty > 0) total = (currentPrice + packagingCost) * qty;
        
        const priceStr = total.toLocaleString();
        document.getElementById('headerPrice').innerText = priceStr;
        document.getElementById('displayPriceCheckout').innerText = priceStr + "ì›";
    }

    function setMode(m) {
        currentMode = m;
        const mock = document.getElementById('towelMockup'), txt = document.getElementById('modeText'), embBg = document.querySelector('.embroidery-bg'), btnP = document.getElementById('btn-p'), btnE = document.getElementById('btn-e'), warning = document.getElementById('embroideryWarning');
        
        if(m === 'print') { 
            mock.className='mode-print'; txt.innerText='â— ì „ì‚¬ ì¸ì‡„ (í™”ì´íŠ¸ ë°´ë“œ) ë¯¸ë¦¬ë³´ê¸°'; embBg.style.display='none'; canvas.backgroundColor='#ffffff'; 
            btnP.classList.add('active'); btnE.classList.remove('active');
            warning.style.display = 'none';
        } else { 
            mock.className='mode-embroidery'; txt.innerText='â— ì»´í“¨í„° ììˆ˜ (ì¼ë°˜ ìˆ˜ê±´) ë¯¸ë¦¬ë³´ê¸°'; embBg.style.display='block'; canvas.backgroundColor=null; 
            btnE.classList.add('active'); btnP.classList.remove('active');
            warning.style.display = 'block';
        }
        canvas.renderAll();
    }
    
    function setTowel(c, el) { 
        currentTowelColor = c; 
        document.documentElement.style.setProperty('--towel-color', c); 
        document.querySelectorAll('.color-circle').forEach(t=>t.classList.remove('active')); 
        if(el) el.classList.add('active'); 
        setMode(currentMode); 
    }
    
    function changeObjColor(v) { 
        const o = canvas.getActiveObject(); 
        if (o) {
            if (o.isEditing && o.selectionStart !== o.selectionEnd) {
                o.setSelectionStyles({ fill: v });
            } else {
                o.set('fill', v); 
                if(o.paths) { o.paths.forEach(p => p.set({ fill: v })); }
            }
            canvas.renderAll(); 
            document.getElementById('textColorPicker').value = v;
            document.getElementById('iconColorPicker').value = v;
        } 
    }

    function changeFontSize(val) {
        const o = canvas.getActiveObject();
        if(o && (o.type === 'i-text' || o.type === 'text')) {
            o.set('fontSize', parseInt(val, 10));
            canvas.renderAll();
            document.getElementById('fontSizeDisplay').innerText = val;
        }
    }

    function setTextAlign(align) {
        const o = canvas.getActiveObject();
        if(o && (o.type === 'i-text' || o.type === 'text')) {
            o.set('textAlign', align);
            canvas.renderAll();
        }
    }

    function addText(f, t) { 
        const it = new fabric.IText(t, { left: 100, top: 25, fontFamily: f, fontSize: 40, fill: document.getElementById('textColorPicker').value }); 
        canvas.add(it).centerObject(it).setActiveObject(it); 
    }
    function addIcon(n) { 
        const p = new fabric.Path(iconPaths[n], { fill: document.getElementById('iconColorPicker').value, scaleX: 1.5, scaleY: 1.5 }); 
        canvas.add(p).centerObject(p).setActiveObject(p); 
    }
    
    function addDesignImage(url) {
        fabric.Image.fromURL(url, (img) => {
            img.scaleToHeight(80); 
            canvas.add(img).centerObject(img).setActiveObject(img);
        }, { crossOrigin: 'anonymous' });
    }

    function alignObj(type) { const o = canvas.getActiveObject(); if(!o) return; if(type === 'left') o.set({ left: 10 }); else if(type === 'right') o.set({ left: canvas.width - o.getScaledWidth() - 10 }); else if(type === 'centerH') canvas.centerObjectH(o); else if(type === 'centerFull') canvas.centerObject(o); o.setCoords(); canvas.renderAll(); }
    function changeLayer(d) { const o = canvas.getActiveObject(); if(!o) return; if(d === 'front') o.bringForward(); else o.sendBackwards(); canvas.sendToBack(guide); canvas.renderAll(); }
    function deleteObj() { canvas.getActiveObjects().forEach(o => canvas.remove(o)); canvas.discardActiveObject().renderAll(); }
    
    window.addEventListener('keydown', (e) => {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

        const activeObj = canvas.getActiveObject();
        if (activeObj) {
            const step = e.shiftKey ? 10 : 1; 
            let moved = false;

            switch (e.key) {
                case 'ArrowUp': activeObj.top -= step; moved = true; break;
                case 'ArrowDown': activeObj.top += step; moved = true; break;
                case 'ArrowLeft': activeObj.left -= step; moved = true; break;
                case 'ArrowRight': activeObj.left += step; moved = true; break;
                case 'Delete': 
                case 'Backspace': 
                    if (!activeObj.isEditing) { deleteObj(); moved = true; }
                    break;
            }

            if (moved) {
                e.preventDefault(); 
                activeObj.setCoords();
                canvas.renderAll();
            }
        }
    });

    canvas.on('selection:created', updateControls);
    canvas.on('selection:updated', updateControls);
    
    function updateControls() {
        const o = canvas.getActiveObject();
        if(o) {
            if(o.fill && typeof o.fill === 'string') {
                document.getElementById('textColorPicker').value = o.fill;
                document.getElementById('iconColorPicker').value = o.fill;
            }
            if(o.fontSize) {
                document.getElementById('fontSizeSlider').value = o.fontSize;
                document.getElementById('fontSizeDisplay').innerText = o.fontSize;
            }
        }
    }

    // [New] ì´ë¯¸ì§€ ìë¥´ê¸° ë¡œì§
    document.getElementById('upload').onchange = (e) => { 
        const files = e.target.files;
        if(files && files.length > 0) {
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (evt) => {
                imageToCrop.src = evt.target.result;
                cropModal.style.display = 'flex'; // ëª¨ë‹¬ ì—´ê¸°
                if(cropper) { cropper.destroy(); } // ê¸°ì¡´ í¬ë¡œí¼ ì´ˆê¸°í™”
                cropper = new Cropper(imageToCrop, {
                    viewMode: 1,
                    autoCropArea: 0.8,
                });
            };
            reader.readAsDataURL(file);
        }
    };

    function cancelCrop() {
        cropModal.style.display = 'none';
        document.getElementById('upload').value = ''; // ì…ë ¥ ì´ˆê¸°í™”
        if(cropper) { cropper.destroy(); cropper = null; }
    }

function confirmCrop() {
    if(!cropper) return;

    // 1. í¬ë¡œí¼ì—ì„œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¬ ë•Œ í•´ìƒë„ë¥¼ ê°•ì œë¡œ ë†’ì…ë‹ˆë‹¤.
    const canvasData = cropper.getCroppedCanvas({
        width: 1500, // ë” ë„‰ë„‰í•˜ê²Œ 1500í”½ì…€ë¡œ ì„¤ì • (í™”ì§ˆ í–¥ìƒ)
        imageSmoothingQuality: 'high' // ìµœìƒì˜ ë¶€ë“œëŸ¬ì›€ ì ìš©
    });

    if(canvasData) {
        const croppedDataUrl = canvasData.toDataURL('image/png', 1.0); // ìµœê³  í’ˆì§ˆ PNG ì¶”ì¶œ
        fabric.Image.fromURL(croppedDataUrl, (img) => {
            img.scaleToHeight(100); 
            canvas.add(img).centerObject(img).setActiveObject(img);
            canvas.renderAll(); // ìº”ë²„ìŠ¤ ì¦‰ì‹œ ê°±ì‹ 
        });
        cancelCrop(); // ëª¨ë‹¬ ë‹«ê¸° ë° ì´ˆê¸°í™”
    }
}

async function sendDataToGoogleSheet() {
    // 1. ìƒ‰ìƒ ì½”ë“œì™€ í•œê¸€ ì´ë¦„ì„ ë§¤ì¹­í•˜ëŠ” ì‚¬ì „ (ì˜µì…˜ê´€ë¦¬ ì‹œíŠ¸ì˜ ì»¬ëŸ¬ ìˆœì„œëŒ€ë¡œ ì¶”ê°€í•˜ì„¸ìš”)
    const colorMap = {
        "#ffffff": "í™”ì´íŠ¸",
        "#800020": "ì™€ì¸",
        "#000000": "ë¸”ë™",
        "#f5f5f0": "ì•„ì´ë³´ë¦¬",
        "#d3d3d3": "ë¼ì´íŠ¸ê·¸ë ˆì´",
        // í•„ìš”í•œ ìƒ‰ìƒì„ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”.
    };

    // 2. í˜„ì¬ ì„ íƒëœ ì½”ë“œì— í•´ë‹¹í•˜ëŠ” ì´ë¦„ì„ ì°¾ê³ , ì—†ìœ¼ë©´ ì½”ë“œ ê·¸ëŒ€ë¡œ í‘œì‹œ
    const colorName = colorMap[currentTowelColor] || currentTowelColor;

    const name = document.getElementById('custName').value, 
          phone = document.getElementById('custPhone').value, 
          address = document.getElementById('custAddress').value, 
          deliveryDate = document.getElementById('custDeliveryDate').value;
    
    const qty = document.getElementById('custQty').value, 
          totalPrice = document.getElementById('displayPriceCheckout').innerText;
    
    const packIndex = document.getElementById('packagingSelect').value, 
          packName = packagingData[packIndex].name;

    if(!name || !phone || !address) { showPopup("ì•Œë¦¼", "ì„±í•¨, ì—°ë½ì²˜, ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤!"); return; }
    if(!qty || qty < 1) { showPopup("ì•Œë¦¼", "ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

    try {
        guide.visible = false;
        const imageData = canvas.toDataURL({ format: 'png', multiplier: 5, quality: 1.0 }); 
        guide.visible = true; 
        canvas.renderAll();

        const orderData = { 
            name, 
            phone, 
            address, 
            deliveryDate, 
            quantity: qty, 
            totalPrice: totalPrice, 
            productName: selectedProductName, 
            color: colorName, // [ìˆ˜ì •ë¨] ì´ì œ #000000 ëŒ€ì‹  "ë¸”ë™"ì´ ì „ì†¡ë©ë‹ˆë‹¤.
            packaging: packName, 
            image: imageData 
        };
        
        showPopup("ì£¼ë¬¸ ì „ì†¡ ì¤‘", "ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...");
        
        await fetch(scriptURL, { 
            method: 'POST', 
            mode: 'no-cors', 
            body: JSON.stringify(orderData) 
        });
        
        showPopup("âœ… ì£¼ë¬¸ ì™„ë£Œ!", "ì£¼ë¬¸ì„œê°€ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.");
    } catch(e) {
        showPopup("ì „ì†¡ ì˜¤ë¥˜", "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
    }
}

    fetchData();
</script>
</body>
</html>




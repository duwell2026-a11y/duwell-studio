<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DUWELL Studio - ì£¼ë¬¸ì„œ íŒŒì¼ ê¸°ëŠ¥</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&family=Noto+Sans+KR:wght@100;300;400;500;700;900&family=Black+Han+Sans&family=Do+Hyeon&family=Song+Myung&family=Nanum+Pen+Script&family=Gamja+Flower&family=East+Sea+Dokdo&family=Hi+Melody&family=Sunflower:wght@300;500;700&family=Gothic+A1:wght@100;400;700;900&family=Poor+Story&family=Gaegu:wght@300;400;700&family=Yeon+Sung&family=Jua&family=Dokdo&family=Stylish&family=Gugi&family=Kirang+Haerang&family=Playfair+Display:wght@400;700&family=Montserrat:wght@100;400;700;900&family=Pacifico&family=Cinzel:wght@400;700&family=Dancing+Script:wght@400;700&family=Bebas+Neue&family=Orbitron:wght@400;700&family=Lobster&family=Anton&family=Indie+Flower&family=Shadows+Into+Light&family=Permanent+Marker&family=Amatic+SC:wght@400;700&family=Caveat:wght@400;700&family=Satisfy&family=Courgette&display=swap" rel="stylesheet">
    <style>
        :root { 
            --duwell-wine: #800020; 
            --towel-color: #ffffff;
            --towel-texture: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8Y2lyY2xlIGN4PSIyIiBjeT0iMiIgcj0iMSIgZmlsbD0iIzAwMCIgZmlsbC1vcGFjaXR5PSIwLjEiLz4KPC9zdmc+');
            --band-texture: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAABVJREFUCB1jYACCCxb8Z2BgYARjAAcAAf8B/9+0AAAAAElFTkSuQmCC');
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { font-family: 'Noto Sans KR', sans-serif; background: #e0e4e8; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .container { display: flex; width: 100%; height: 100%; }
        .sidebar { width: 420px; background: white; box-shadow: 4px 0 20px rgba(0,0,0,0.1); padding: 25px; z-index: 20; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        
        .workspace { 
            flex: 1; 
            background-color: #d1d8e0;
            background-image: radial-gradient(#bbc 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
        }

        @media (max-width: 900px) {
            body { height: auto; overflow-y: auto; }
            .container { flex-direction: column; height: auto; }
            .workspace { 
                order: 1; width: 100%; min-height: 320px; position: sticky; top: 0; z-index: 100;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1); padding: 30px 0;
            }
            .sidebar { order: 2; width: 100%; height: auto; padding: 20px; overflow-y: visible; }
        }

        .logo { color: var(--duwell-wine); font-size: 24px; font-weight: 900; text-align: center; border-bottom: 2px solid var(--duwell-wine); padding-bottom: 10px; margin: 0; }
        .group { padding-bottom: 15px; border-bottom: 1px solid #eee; }
        label { display: block; font-weight: 700; margin-bottom: 10px; font-size: 14px; color: #333; }
        
        .item-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; max-height: 180px; overflow-y: auto; padding: 5px; background: #f9f9f9; border-radius: 8px; }
        .item-btn { padding: 12px 5px; border: 1px solid #ddd; background: white; cursor: pointer; font-size: 12px; border-radius: 6px; text-align: center; transition: 0.2s; font-weight: 500; }
        .item-btn:active { background: #fff0f3; border-color: var(--duwell-wine); }
        
        .towel-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; justify-items: center; max-height: 150px; overflow-y: auto; padding: 5px; }
        .towel-option { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #ddd; cursor: pointer; transition: transform 0.2s; box-shadow: inset 0 0 5px rgba(0,0,0,0.1); }
        .towel-option.active { border-color: var(--duwell-wine); transform: scale(1.1); border-width: 3px; }

        .control-panel { display: flex; align-items: center; gap: 10px; margin-top: 10px; background: #fdfdfd; padding: 12px; border-radius: 8px; border: 1px solid #eee; }
        .size-display { font-weight: bold; color: var(--duwell-wine); min-width: 55px; text-align: center; border: 1px solid var(--duwell-wine); border-radius: 4px; padding: 4px; font-size: 13px; }
        
        .align-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 5px; }
        .align-btn { padding: 8px 0; border: 1px solid #ddd; background: #fff; border-radius: 4px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
        
        .mode-switch { display: flex; gap: 10px; margin-bottom: 10px; background: #f0f0f0; padding: 5px; border-radius: 10px; }
        .mode-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; transition: 0.3s; background: transparent; color: #666; }
        .mode-btn.active { background: var(--duwell-wine); color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }

        #emb-notice {
            display: none; font-size: 12px; color: #e74c3c; line-height: 1.5; background: #fff0f0; padding: 10px; border-radius: 8px; border: 1px solid #ffcccc; margin-top: 5px;
        }

        #towelMockup {
            width: 900px;
            display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.25), 0 3px 10px rgba(0,0,0,0.1);
            position: relative;
            transform-origin: top center;
            transition: all 0.3s ease;
        }

        .terry-texture {
            background-color: var(--towel-color);
            background-image: var(--towel-texture);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05); 
        }
        
        .towel-top { 
            width: 100%; height: 70px; border-radius: 12px 12px 0 0; position: relative; z-index: 2; 
            background: linear-gradient(to bottom, rgba(255,255,255,0.3) 0%, rgba(0,0,0,0.05) 100%), var(--towel-color);
            background-blend-mode: overlay, normal;
        }
        
        .towel-bottom { 
            width: 100%; height: 90px; border-radius: 0 0 12px 12px; position: relative; z-index: 2; 
            background: linear-gradient(to top, rgba(0,0,0,0.1) 0%, rgba(255,255,255,0.1) 100%), var(--towel-color);
            background-blend-mode: multiply, normal;
        }

        .band-container { width: 100%; position: relative; z-index: 1; }
        
        .embroidery-bg {
            position: absolute; top:0; left:0; width:100%; height:100%; display: none;
            background-color: var(--towel-color); 
        }

        .canvas-band-wrapper { width: 100%; display: flex; justify-content: center; position: relative; transition: all 0.3s ease; }

        .mode-print .canvas-band-wrapper {
            background: #ffffff; 
            padding: 4px 0;
            box-shadow: inset 0 4px 6px rgba(0,0,0,0.15), inset 0 -4px 6px rgba(0,0,0,0.15);
            border-top: 1px solid rgba(0,0,0,0.05);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .mode-print .embroidery-bg { display: none; }

        .mode-embroidery .canvas-band-wrapper { background: transparent; padding: 0; box-shadow: none; border: none; }
        .mode-embroidery .embroidery-bg { display: block; }
        .mode-embroidery .towel-top { border-radius: 12px 12px 0 0; margin-bottom: -1px; } 
        .mode-embroidery .towel-bottom { border-radius: 0 0 12px 12px; margin-top: -1px; }

        .canvas-container { border: none !important; } 
        
        .upload-area { background: #fffafb; border: 2px dashed var(--duwell-wine); padding: 20px; border-radius: 10px; text-align: center; cursor: pointer; font-weight: bold; color: var(--duwell-wine); }
        .action-btn { width: 100%; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; border: none; font-size: 14px; margin-top: 5px; transition: 0.2s; }
        .action-btn:hover { opacity: 0.9; transform: scale(1.01); }
        
        /* ë²„íŠ¼ ì»¬ëŸ¬ */
        .btn-print { background: var(--duwell-wine); color: white; }
        .btn-svg { background: #34495e; color: white; }
        .btn-txt { background: #2ecc71; color: white; } /* ì£¼ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        .btn-copy { background: #1a1a1a; color: white; } /* ë³µì‚¬ ë²„íŠ¼ */
        
        input[type="range"] { accent-color: var(--duwell-wine); flex: 1; height: 20px; }
        input[type="color"] { width: 40px; height: 40px; border: none; border-radius: 50%; overflow: hidden; cursor: pointer; }

        .layer-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .icon-btn { font-size: 20px; line-height: 1; padding: 8px; border: 1px solid #eee; background: white; cursor: pointer; border-radius: 4px; }
        .icon-btn:hover { background-color: #f5f5f5; border-color: #ccc; }

        .input-field { width: 100%; padding: 10px; margin-bottom: 8px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Noto Sans KR'; font-size: 13px; }
        .input-field:focus { border-color: var(--duwell-wine); outline: none; }
        
        .delivery-notice {
            background-color: #f8f9fa; border: 1px solid #eee; padding: 10px; border-radius: 6px; margin-bottom: 10px;
            font-size: 11px; color: #555; line-height: 1.5; letter-spacing: -0.5px;
        }
        .delivery-notice strong { color: var(--duwell-wine); }
        
        .step-title { font-size: 14px; font-weight: 800; color: #333; margin: 15px 0 5px 0; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="workspace">
        <div id="responsiveWrapper" style="display:flex; justify-content:center;">
            <div id="towelMockup" class="mode-print">
                <div class="towel-body towel-top terry-texture"></div>
                <div class="band-container">
                    <div class="embroidery-bg terry-texture"></div>
                    <div class="canvas-band-wrapper">
                        <canvas id="mainCanvas"></canvas>
                    </div>
                </div>
                <div class="towel-body towel-bottom terry-texture"></div>
            </div>
        </div>
        <p id="infoText" style="margin-top: 25px; color: #333; font-weight: bold; font-size: 14px; text-align: center; z-index: 200; background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 20px;">
            <span style="color:var(--duwell-wine)">â—</span> <span id="modeText">ì „ì‚¬ ì¸ì‡„ (í™”ì´íŠ¸ ë°´ë“œ ê³ ì •)</span> ë¯¸ë¦¬ë³´ê¸°
        </p>
    </div>

    <div class="sidebar">
        <h1 class="logo">DUWELL STUDIO</h1>
        <div class="group">
            <label>ğŸ› ï¸ ì‘ì—… ë°©ì‹ ì„ íƒ (í•„ìˆ˜)</label>
            <div class="mode-switch">
                <button class="mode-btn active" id="btn-print" onclick="setMode('print')">ğŸ–¨ï¸ ì „ì‚¬ ì¸ì‡„</button>
                <button class="mode-btn" id="btn-embroidery" onclick="setMode('embroidery')">ğŸ§µ ì»´í“¨í„° ììˆ˜</button>
            </div>
            
            <div id="emb-notice">
                <b>[ì•ˆë‚´]</b> ììˆ˜ëŠ” ì‰í¬ ì¸ì‡„ê°€ ì•„ë‹Œ 'ì‹¤'ë¡œ ì‘ì—…í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.<br>
                í™”ë©´ì—ì„œ ë³´ì‹œëŠ” ìƒ‰ìƒê³¼ <b>ê°€ì¥ ìœ ì‚¬í•œ ì‹¤ ì»¬ëŸ¬</b>ë¡œ ëŒ€ì²´ë˜ì–´ ì œì‘ë˜ë¯€ë¡œ, ë¯¸ì„¸í•œ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
        </div>

        <div class="group">
            <label>ğŸ› ìˆ˜ê±´ ìƒ‰ìƒ ì„ íƒ</label>
            <div class="towel-grid">
                <div class="towel-option" style="background: #ffffff;" onclick="setTowel('#ffffff')" title="í™”ì´íŠ¸"></div>
                <div class="towel-option" style="background: #f5f5dc;" onclick="setTowel('#f5f5dc')" title="ì•„ì´ë³´ë¦¬"></div>
                <div class="towel-option" style="background: #800020;" onclick="setTowel('#800020')" title="ì™€ì¸"></div>
                <div class="towel-option" style="background: #2f3640;" onclick="setTowel('#2f3640')" title="ë‹¤í¬ë„¤ì´ë¹„"></div>
                <div class="towel-option" style="background: #a4a4a4;" onclick="setTowel('#a4a4a4')" title="ê·¸ë ˆì´"></div>
                <div class="towel-option" style="background: #ffcccc;" onclick="setTowel('#ffcccc')" title="ë² ì´ë¹„í•‘í¬"></div>
                <div class="towel-option" style="background: #dff9fb;" onclick="setTowel('#dff9fb')" title="ìŠ¤ì¹´ì´ë¸”ë£¨"></div>
                <div class="towel-option" style="background: #e1b12c;" onclick="setTowel('#e1b12c')" title="ë¨¸ìŠ¤íƒ€ë“œ"></div>
                <div class="towel-option" style="background: #b0e0e6;" onclick="setTowel('#b0e0e6')" title="íŒŒìš°ë”ë¸”ë£¨"></div>
                <div class="towel-option" style="background: #98fb98;" onclick="setTowel('#98fb98')" title="í˜ì¼ê·¸ë¦°"></div>
                <div class="towel-option" style="background: #e6e6fa;" onclick="setTowel('#e6e6fa')" title="ë¼ë²¤ë”"></div>
                <div class="towel-option" style="background: #f08080;" onclick="setTowel('#f08080')" title="ë¼ì´íŠ¸ì½”ë„"></div>
                <div class="towel-option" style="background: #4682b4;" onclick="setTowel('#4682b4')" title="ìŠ¤í‹¸ë¸”ë£¨"></div>
                <div class="towel-option" style="background: #556b2f;" onclick="setTowel('#556b2f')" title="ì˜¬ë¦¬ë¸Œê·¸ë¦°"></div>
                <div class="towel-option" style="background: #8b4513;" onclick="setTowel('#8b4513')" title="ìƒˆë“¤ë¸Œë¼ìš´"></div>
                <div class="towel-option" style="background: #708090;" onclick="setTowel('#708090')" title="ìŠ¬ë ˆì´íŠ¸ê·¸ë ˆì´"></div>
                <div class="towel-option" style="background: #000080;" onclick="setTowel('#000080')" title="ë„¤ì´ë¹„"></div>
                <div class="towel-option" style="background: #006400;" onclick="setTowel('#006400')" title="ë‹¤í¬ê·¸ë¦°"></div>
            </div>
        </div>
        
        <div class="group">
            <label>ğŸ“ ì£¼ë¬¸ ê³ ê° ì •ë³´ (ë©”ì¼ ë°œì†¡ìš©)</label>
            <input type="text" id="custName" placeholder="ì„±í•¨ (ì˜ˆ: í™ê¸¸ë™)" class="input-field">
            <input type="tel" id="custPhone" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)" class="input-field">
            <input type="text" id="custAddress" placeholder="ë°°ì†¡ì§€ ì£¼ì†Œ" class="input-field">
            
            <label style="font-size:12px; margin-top:10px; margin-bottom:5px; color:#555;">ğŸ“… í¬ë§ ë°°ì†¡ì¼ (ì„ íƒ)</label>
            <input type="date" id="custDeliveryDate" class="input-field">
            
            <div class="delivery-notice">
                âš ï¸ <b>ì œì‘ ê¸°ê°„ ì•ˆë‚´ (ë°œì†¡ì¼ ê¸°ì¤€ í‰ì¼)</b><br>
                - <b>ì „ì‚¬ ì¸ì‡„:</b> 2~3ì¼ ì†Œìš”<br>
                - <b>ì»´í“¨í„° ììˆ˜:</b> 5~6ì¼ ì†Œìš”<br>
                <span style="color:#888; margin-top:3px; display:block;">* ì£¼ë¬¸ ë¬¼ëŸ‰ì— ë”°ë¼ ì¼ì •ì´ ì§€ì—°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>* íƒë°°ì‚¬ ì‚¬ì •ì— ë”°ë¼ ë°°ì†¡ ì™„ë£Œì¼ì€ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</span>
            </div>

            <label style="font-size:12px; margin-bottom:5px; color:#555;">ğŸ‰ í–‰ì‚¬ ë‚ ì§œ (ì„ íƒ)</label>
            <input type="date" id="custDate" class="input-field">
        </div>

        <div class="group">
            <label>âœ¨ ì‹¬ë³¼ ì•„ì´ì½˜ (20ì¢… ì •ì˜ˆ)</label>
            <div class="item-grid" style="grid-template-columns: repeat(5, 1fr);">
                <button class="icon-btn" onclick="addIcon('heart')" title="í•˜íŠ¸">â™¥</button>
                <button class="icon-btn" onclick="addIcon('star')" title="ë³„">â˜…</button>
                <button class="icon-btn" onclick="addIcon('crown')" title="ì™•ê´€">ğŸ‘‘</button>
                <button class="icon-btn" onclick="addIcon('gift')" title="ì„ ë¬¼ìƒì">ğŸ</button>
                <button class="icon-btn" onclick="addIcon('music')" title="ìŒí‘œ">ğŸµ</button>
                <button class="icon-btn" onclick="addIcon('camera')" title="ì¹´ë©”ë¼">ğŸ“·</button>
                <button class="icon-btn" onclick="addIcon('cross')" title="êµíšŒì‹­ìê°€">âœï¸</button>
                <button class="icon-btn" onclick="addIcon('home')" title="ì§‘">ğŸ </button>
                <button class="icon-btn" onclick="addIcon('smile')" title="ìŠ¤ë§ˆì¼">ğŸ™‚</button>
                <button class="icon-btn" onclick="addIcon('check')" title="ì²´í¬">âœ”</button>
                <button class="icon-btn" onclick="addIcon('plane')" title="ë¹„í–‰ê¸°">âœˆï¸</button>
                <button class="icon-btn" onclick="addIcon('car')" title="ìë™ì°¨">ğŸš—</button>
                <button class="icon-btn" onclick="addIcon('thumbsup')" title="ì—„ì§€ì²™">ğŸ‘</button>
                <button class="icon-btn" onclick="addIcon('sun')" title="í•´">â˜€ï¸</button>
                <button class="icon-btn" onclick="addIcon('moon')" title="ë‹¬">ğŸŒ™</button>
                <button class="icon-btn" onclick="addIcon('cloud')" title="êµ¬ë¦„">â˜ï¸</button>
                <button class="icon-btn" onclick="addIcon('circle')" title="ì›">â—</button>
                <button class="icon-btn" onclick="addIcon('square')" title="ì‚¬ê°í˜•">â– </button>
                <button class="icon-btn" onclick="addIcon('triangle')" title="ì‚¼ê°í˜•">â–²</button>
                <button class="icon-btn" onclick="addIcon('diamond')" title="ë‹¤ì´ì•„">ğŸ’</button>
            </div>
        </div>

        <div class="group">
            <label>ğŸ”¤ í°íŠ¸ & ìŠ¤íƒ€ì¼</label>
            <div class="item-grid" style="max-height: 200px;">
                <button class="item-btn" style="font-family:'Noto Sans KR'; font-weight:400;" onclick="addText('Noto Sans KR', 'ê¸°ë³¸ ê³ ë”•')">ê¸°ë³¸ ê³ ë”•</button>
                <button class="item-btn" style="font-family:'Nanum Myeongjo'; font-weight:400;" onclick="addText('Nanum Myeongjo', 'ë‚˜ëˆ” ëª…ì¡°')">ë‚˜ëˆ” ëª…ì¡°</button>
                <button class="item-btn" style="font-family:'Do Hyeon'" onclick="addText('Do Hyeon', 'ë„í˜„ì²´')">ë„í˜„ì²´</button>
                <button class="item-btn" style="font-family:'Jua'" onclick="addText('Jua', 'ì£¼ì•„ì²´')">ì£¼ì•„ì²´</button>
                <button class="item-btn" style="font-family:'Yeon Sung'" onclick="addText('Yeon Sung', 'ì—°ì„±ì²´')">ì—°ì„±ì²´</button>
                <button class="item-btn" style="font-family:'Gugi'" onclick="addText('Gugi', 'êµ¬ê¸°ì²´')">êµ¬ê¸°ì²´</button>
                <button class="item-btn" style="font-family:'East Sea Dokdo'" onclick="addText('East Sea Dokdo', 'ë™í•´ ë…ë„')">ë™í•´ ë…ë„</button>
                <button class="item-btn" style="font-family:'Nanum Pen Script'" onclick="addText('Nanum Pen Script', 'ë‚˜ëˆ” íœ')">ë‚˜ëˆ” íœ</button>
                <button class="item-btn" style="font-family:'Gamja Flower'" onclick="addText('Gamja Flower', 'ê°ìê½ƒ')">ê°ìê½ƒ</button>
                <button class="item-btn" style="font-family:'Black Han Sans'" onclick="addText('Black Han Sans', 'ê²€ì€ ê³ ë”•')">ê²€ì€ ê³ ë”•</button>
                <button class="item-btn" style="font-family:'Playfair Display'" onclick="addText('Playfair Display', 'Playfair (ì˜)')">Playfair (ì˜)</button>
                <button class="item-btn" style="font-family:'Montserrat'" onclick="addText('Montserrat', 'Montserrat (ì˜)')">Montserrat (ì˜)</button>
                <button class="item-btn" style="font-family:'Pacifico'" onclick="addText('Pacifico', 'Pacifico (ì˜)')">Pacifico (ì˜)</button>
                <button class="item-btn" style="font-family:'Dancing Script'" onclick="addText('Dancing Script', 'Dancing (ì˜)')">Dancing (ì˜)</button>
            </div>
            <div class="control-panel">
                <span style="font-size:12px; font-weight:bold;">í¬ê¸°</span>
                <input type="range" id="sizeRange" min="10" max="150" value="35" oninput="updateFontSize(this.value)">
                <div id="sizeNum" class="size-display">35px</div>
            </div>
            <div class="control-panel">
                <span style="font-size:12px; font-weight:bold; flex:1;">ìƒ‰ìƒ (ê¸€ì/ì•„ì´ì½˜)</span>
                <input type="color" id="textColorPicker" value="#333333" oninput="changeTextColor(this.value)">
            </div>
        </div>
        
        <div class="group">
            <label>ğŸ“¸ ë‚´ ì´ë¯¸ì§€ ì¶”ê°€</label>
            <div class="upload-area" onclick="document.getElementById('upload').click()">
                ğŸ“‚ ì‚¬ì§„ ë¶ˆëŸ¬ì˜¤ê¸°
                <input type="file" id="upload" accept="image/*" style="display:none">
            </div>
        </div>

        <div class="group">
            <label>ğŸ“ ì •ë ¬ ë„êµ¬</label>
            <div class="align-grid">
                <button class="align-btn" onclick="alignObj('left')" title="ì™¼ìª½">â‡¤</button>
                <button class="align-btn" onclick="alignObj('centerH')" title="ê°€ë¡œ ì¤‘ì•™">â†”</button>
                <button class="align-btn" onclick="alignObj('right')" title="ì˜¤ë¥¸ìª½">â‡¥</button>
                <button class="align-btn" onclick="alignObj('center')" title="ì •ì¤‘ì•™" style="font-weight:bold; color:var(--duwell-wine);">âœš</button>
                <button class="align-btn" onclick="alignObj('centerV')" title="ì„¸ë¡œ ì¤‘ì•™">â†•</button>
            </div>
        </div>

        <div class="group" style="border:none;">
            <label>âš™ï¸ í¸ì§‘ ë„êµ¬</label>
            <div class="layer-grid">
                <button class="item-btn" onclick="changeLayer('bringToFront')" title="ë§¨ ìœ„ë¡œ">â«</button>
                <button class="item-btn" onclick="changeLayer('bringForward')" title="í•œ ì¹¸ ìœ„ë¡œ">ğŸ”¼</button>
                <button class="item-btn" onclick="changeLayer('sendBackwards')" title="í•œ ì¹¸ ì•„ë˜ë¡œ">ğŸ”½</button>
                <button class="item-btn" onclick="changeLayer('sendToBack')" title="ë§¨ ì•„ë˜ë¡œ">â¬</button>
                <button class="item-btn" style="color:red; border-color:red; font-weight:bold;" onclick="deleteObj()" title="ì‚­ì œ">âŒ</button>
            </div>
        </div>

        <div class="guide-box" style="margin-top: 20px;">
            <span class="step-title">1ï¸âƒ£ í•„ìˆ˜ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</span>
            <p class="guide-text" id="downloadGuideText">ì‘ì—… ë°©ì‹ì— ë§ëŠ” íŒŒì¼ì„ ë¨¼ì € ë‹¤ìš´ë¡œë“œí•´ì£¼ì„¸ìš”.</p>
            
            <div style="margin-top:5px; display:flex; gap:5px; flex-direction:column;">
                <button class="action-btn btn-print" id="btnDlImage" onclick="exportPrint()">ğŸ’¾ ë””ìì¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</button>
                <button class="action-btn btn-svg" id="btnDlSvg" onclick="exportSVG()">ğŸ§µ ììˆ˜ìš© ë°ì´í„° ë‹¤ìš´ë¡œë“œ</button>
            </div>

            <span class="step-title" style="margin-top:20px;">2ï¸âƒ£ ì£¼ë¬¸ì„œ ì ‘ìˆ˜ (íŒŒì¼ì²¨ë¶€ í•„ìˆ˜)</span>
            <p class="guide-text">ì…ë ¥í•˜ì‹  ì£¼ë¬¸ ì •ë³´ë¥¼ í…ìŠ¤íŠ¸ íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ ë³µì‚¬í•˜ì—¬ ë©”ì¼ì— ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.</p>
            
            <div style="margin-top:5px; display:flex; gap:5px; flex-direction:column;">
                <button class="action-btn btn-txt" onclick="downloadOrderSheet()">ğŸ“„ ì£¼ë¬¸ì„œ(í…ìŠ¤íŠ¸íŒŒì¼) ë‹¤ìš´ë¡œë“œ</button>
                
                <button class="action-btn btn-copy" onclick="copyOrderToClipboard()">ğŸ“‹ ì£¼ë¬¸ë‚´ìš© ë³µì‚¬í•˜ê¸°</button>
            </div>
            
            <p class="guide-alert" style="margin-top:10px;">
                â€» <b>[ì£¼ë¬¸ì„œ íŒŒì¼]</b>ê³¼ <b>[ë””ìì¸ íŒŒì¼]</b>ì„ ëª¨ë‘ ì²¨ë¶€í•˜ì—¬<br>
                <span style="color:black; background:#ffeb3b; padding:2px;">duwell2026@gmail.com</span> ìœ¼ë¡œ ë³´ë‚´ì£¼ì„¸ìš”.
            </p>
        </div>
    </div>
</div>

<script>
    const canvas = new fabric.Canvas('mainCanvas', { 
        width: 866, height: 100, backgroundColor: '#ffffff', preserveObjectStacking: true 
    });

    let currentMode = 'print'; 
    let currentTowelColor = '#ffffff';

    const iconPaths = {
        'heart': 'M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z',
        'star': 'M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z',
        'crown': 'M5 16L3 5l5.5 5L12 4l3.5 6L21 5l-2 11H5zm14 3c0 .6-.4 1-1 1H6c-.6 0-1-.4-1-1v-1h14v1z',
        'gift': 'M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1 1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1 1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z',
        'music': 'M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z',
        'camera': 'M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z',
        'cross': 'M11 2v6H5v4h6v10h4V12h6V8h-6V2z',
        'home': 'M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z',
        'smile': 'M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z',
        'check': 'M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z',
        'plane': 'M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z',
        'car': 'M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z',
        'thumbsup': 'M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-1.91l-.01-.01L23 10z',
        'sun': 'M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1z',
        'moon': 'M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z',
        'cloud': 'M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z',
        'circle': 'M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z',
        'square': 'M3 3h18v18H3z',
        'triangle': 'M12 2L2 22h20L12 2z',
        'diamond': 'M19 3H5L2 9l10 12L22 9l-3-6z'
    };

    let guide;
    function initGuide() {
        guide = new fabric.Rect({ left: 5, top: 5, width: 856, height: 90, fill: 'transparent', stroke: '#800020', strokeDashArray: [4, 4], selectable: false, evented: false, opacity: 0.3 });
        canvas.add(guide);
        canvas.sendToBack(guide);
    }
    initGuide();

    function fitCanvasToScreen() {
        const wrapper = document.getElementById('responsiveWrapper');
        const screenWidth = window.innerWidth;
        const towelWidth = 900; 
        if (screenWidth < 920) {
            const padding = 30; 
            const availableWidth = screenWidth - padding;
            const scaleRatio = availableWidth / towelWidth;
            const finalScale = Math.min(scaleRatio, 1);
            wrapper.style.transformOrigin = 'top center';
            wrapper.style.transform = `scale(${finalScale})`;
            wrapper.style.height = `${270 * finalScale}px`;
        } else {
            wrapper.style.transform = 'scale(1)';
            wrapper.style.height = 'auto';
        }
    }
    window.addEventListener('load', fitCanvasToScreen);
    window.addEventListener('resize', fitCanvasToScreen);

    function setMode(mode) {
        currentMode = mode;
        const mockup = document.getElementById('towelMockup');
        const modeText = document.getElementById('modeText');
        const btnPrint = document.getElementById('btn-print');
        const btnEmb = document.getElementById('btn-embroidery');
        const embNotice = document.getElementById('emb-notice'); 
        const guideText = document.getElementById('downloadGuideText');
        const btnDlImage = document.getElementById('btnDlImage');
        const btnDlSvg = document.getElementById('btnDlSvg');

        if (mode === 'print') {
            btnPrint.classList.add('active'); btnEmb.classList.remove('active');
            mockup.className = 'mode-print';
            modeText.innerText = 'ì „ì‚¬ ì¸ì‡„ (í™”ì´íŠ¸ ë°´ë“œ ê³ ì •)';
            embNotice.style.display = 'none';
            guideText.innerHTML = "ì „ì‚¬ ì¸ì‡„ëŠ” <b>[ë””ìì¸ ì´ë¯¸ì§€]</b> 1ê°œë§Œ ë‹¤ìš´ë¡œë“œí•˜ë©´ ë©ë‹ˆë‹¤.";
            btnDlImage.style.display = 'block';
            btnDlSvg.style.display = 'none'; 
            canvas.setBackgroundColor('#ffffff', canvas.renderAll.bind(canvas));
        } else {
            btnPrint.classList.remove('active'); btnEmb.classList.add('active');
            mockup.className = 'mode-embroidery';
            modeText.innerText = 'ì»´í“¨í„° ììˆ˜ (ì¼ë°˜ ìˆ˜ê±´í˜•)';
            embNotice.style.display = 'block';
            guideText.innerHTML = "ììˆ˜ëŠ” <b>[ë””ìì¸ ì´ë¯¸ì§€]</b>ì™€ <b>[ììˆ˜ìš© ë°ì´í„°]</b> 2ê°œ ëª¨ë‘ í•„ìš”í•©ë‹ˆë‹¤.";
            btnDlImage.style.display = 'block';
            btnDlSvg.style.display = 'block';
            canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        }
        canvas.renderAll();
    }

    function setTowel(color) {
        currentTowelColor = color;
        document.documentElement.style.setProperty('--towel-color', color);
        if (currentMode === 'print') {
            canvas.setBackgroundColor('#ffffff', canvas.renderAll.bind(canvas));
        } else {
            canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        }
        document.querySelectorAll('.towel-option').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
        canvas.renderAll();
    }

    function alignObj(pos) {
        const obj = canvas.getActiveObject();
        if (!obj) return;
        switch(pos) {
            case 'left': obj.set({ left: 10 }); break;
            case 'right': obj.set({ left: canvas.width - (obj.getScaledWidth()) - 10 }); break;
            case 'centerH': canvas.centerObjectH(obj); break;
            case 'centerV': canvas.centerObjectV(obj); break;
            case 'center': canvas.centerObject(obj); break;
        }
        obj.setCoords(); canvas.renderAll();
    }

    function addText(font, textStr) {
        const color = document.getElementById('textColorPicker').value;
        const text = new fabric.IText(textStr, { left: 150, top: 25, fontFamily: font, fontSize: 35, fill: color });
        canvas.add(text);
        canvas.centerObject(text);
        canvas.setActiveObject(text);
        syncUI(text);
    }

    function addIcon(iconName) {
        const pathData = iconPaths[iconName];
        if (!pathData) return;
        const color = document.getElementById('textColorPicker').value;
        const path = new fabric.Path(pathData, { fill: color, scaleX: 2, scaleY: 2, left: 100, top: 50 });
        path.scaleToWidth(50); 
        canvas.add(path);
        canvas.centerObject(path);
        canvas.setActiveObject(path);
    }

    function changeTextColor(color) {
        const obj = canvas.getActiveObject();
        if (obj) { obj.set('fill', color); canvas.renderAll(); }
    }

    function updateFontSize(val) {
        document.getElementById('sizeNum').innerText = val + 'px';
        const obj = canvas.getActiveObject();
        if (obj) { 
            if (obj.type === 'i-text') obj.set('fontSize', parseInt(val));
            else if (obj.type === 'path') obj.scaleToWidth(parseInt(val)); 
            canvas.renderAll(); 
        }
    }

    canvas.on('selection:created', (e) => syncUI(e.selected[0]));
    canvas.on('selection:updated', (e) => syncUI(e.selected[0]));
    function syncUI(obj) {
        if (obj) {
            let size = 0;
            if (obj.type === 'i-text') size = obj.fontSize;
            else if (obj.type === 'path') size = obj.getScaledWidth();
            document.getElementById('sizeRange').value = Math.round(size);
            document.getElementById('sizeNum').innerText = Math.round(size) + 'px';
            document.getElementById('textColorPicker').value = obj.fill;
        }
    }

    function changeLayer(action) {
        const obj = canvas.getActiveObject();
        if(!obj) return;
        switch(action) {
            case 'bringToFront': obj.bringToFront(); break; 
            case 'bringForward': obj.bringForward(); break; 
            case 'sendBackwards': obj.sendBackwards(); break; 
            case 'sendToBack': obj.sendToBack(); break; 
        }
        canvas.sendToBack(guide); 
        canvas.renderAll();
    }

    function deleteObj() {
        const activeObjects = canvas.getActiveObjects();
        if (activeObjects.length) {
            canvas.discardActiveObject();
            activeObjects.forEach(obj => canvas.remove(obj));
            canvas.renderAll();
        }
    }

    window.addEventListener('keydown', (e) => {
        const activeObj = canvas.getActiveObject();
        if (activeObj && !activeObj.isEditing && (e.key === 'Delete' || e.key === 'Backspace')) {
            deleteObj();
        }
    });

    document.getElementById('upload').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = (f) => {
            fabric.Image.fromURL(f.target.result, (img) => {
                img.scaleToHeight(80);
                canvas.add(img);
                canvas.centerObject(img);
                canvas.setActiveObject(img);
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    };

    function exportPrint() {
        guide.visible = false;
        const originalBg = canvas.backgroundColor;
        canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        const link = document.createElement('a');
        link.href = canvas.toDataURL({ format: 'png', multiplier: 6 });
        link.download = `DUWELL_PRINT_${currentMode}_${Date.now()}.png`;
        link.click();
        if (currentMode === 'print') canvas.setBackgroundColor('#ffffff', canvas.renderAll.bind(canvas));
        else canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        guide.visible = true;
        canvas.renderAll();
    }

    function exportSVG() {
        guide.visible = false;
        const originalBg = canvas.backgroundColor;
        canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        const svgData = canvas.toSVG({ suppressPreamble: true, viewBox: { x: 0, y: 0, width: canvas.width, height: canvas.height } });
        const link = document.createElement('a');
        const blob = new Blob([svgData], {type: 'image/svg+xml'});
        const url = URL.createObjectURL(blob);
        link.href = url;
        link.download = `DUWELL_EMBROIDERY_${Date.now()}.svg`;
        link.click();
        if (currentMode === 'print') canvas.setBackgroundColor('#ffffff', canvas.renderAll.bind(canvas));
        else canvas.setBackgroundColor(null, canvas.renderAll.bind(canvas));
        guide.visible = true;
        canvas.renderAll();
    }

    // âœ¨ ì£¼ë¬¸ ì •ë³´ ìƒì„± í•¨ìˆ˜ (ê³µí†µ)
    function getOrderInfo() {
        const name = document.getElementById('custName').value || 'ê³ ê°ë‹˜';
        const phone = document.getElementById('custPhone').value || 'ë¯¸ì…ë ¥';
        const address = document.getElementById('custAddress').value || 'ë¯¸ì…ë ¥';
        const deliveryDate = document.getElementById('custDeliveryDate').value || 'ë¯¸ì§€ì •';
        const eventDate = document.getElementById('custDate').value || 'ë¯¸ì •';
        
        return `[DUWELL ì£¼ë¬¸ì„œ]\n- ì„±í•¨: ${name}\n- ì—°ë½ì²˜: ${phone}\n- ë°°ì†¡ì§€: ${address}\n- í¬ë§ë°°ì†¡ì¼: ${deliveryDate}\n- í–‰ì‚¬ë‚ ì§œ: ${eventDate}\n\n* ë°˜ë“œì‹œ ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼(ì´ë¯¸ì§€/ììˆ˜íŒŒì¼)ì„ í•¨ê»˜ ì²¨ë¶€í•´ì£¼ì„¸ìš”.`;
    }

    // ğŸ”¥ 1. ì£¼ë¬¸ì„œ(í…ìŠ¤íŠ¸íŒŒì¼) ë‹¤ìš´ë¡œë“œ
    function downloadOrderSheet() {
        const text = getOrderInfo();
        const blob = new Blob([text], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `DUWELL_ì£¼ë¬¸ì„œ_${document.getElementById('custName').value || 'ê³ ê°'}.txt`;
        link.click();
    }

    // ğŸ”¥ 2. ì£¼ë¬¸ ë‚´ìš© ë³µì‚¬í•˜ê¸°
    function copyOrderToClipboard() {
        const text = getOrderInfo();
        navigator.clipboard.writeText(text).then(() => {
            alert("âœ… ì£¼ë¬¸ ë‚´ìš©ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nì´ì œ ì‚¬ìš©í•˜ì‹œëŠ” ë©”ì¼(ë„¤ì´ë²„, ë‹¤ìŒ ë“±)ì„ ì—´ì–´\në³¸ë¬¸ì— 'ë¶™ì—¬ë„£ê¸°(Ctrl+V)' í•˜ì‹œê³  íŒŒì¼ì„ ì²¨ë¶€í•´ì£¼ì„¸ìš”.");
        }).catch(err => {
            alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ì„œë¥¼ ë‹¤ìš´ë¡œë“œí•´ì£¼ì„¸ìš”.");
        });
    }
</script>
</body>
</html>